/*
# How to run it:
# 1. Open Product Page.
# 2. Paste in Console and press Enter.
# 3. Enter ID. Victory chime plays if found.
*/

(async () => {
    const productId = prompt("Enter Product ID:", "1313903");
    if (!productId) return;

    const cities = ["Andrych√≥w", "August√≥w", "Bartoszyce", "Be≈Çchat√≥w", "Bia≈Ça Podlaska", "Bia≈Çki", "Bia≈Çogard", "Bia≈Çystok", "Bielsk Podlaski", "Bielsko-Bia≈Ça", "Bi≈Çgoraj", "Bochnia", "Bogatynia", "Boles≈Çawiec", "Braniewo", "Brodnica", "Brzeg", "Brzesko", "Bydgoszcz", "Bytom", "Byt√≥w", "Che≈Çm", "Chojnice", "Chorz√≥w", "Choszczno", "Chrzan√≥w", "Ciechan√≥w", "Cieszyn", "Czelad≈∫", "Czƒôstochowa", "DƒÖbrowa G√≥rnicza", "Dƒôbica", "Dƒôblin", "Dzia≈Çdowo", "ElblƒÖg", "E≈Çk", "Garwolin", "Gda≈Ñsk", "Gdynia", "Gi≈ºycko", "Gliwice", "G≈Çog√≥w", "Gniezno", "Gorlice", "Gorz√≥w Wielkopolski", "Gosty≈Ñ", "Grodzisk Mazowiecki", "Gr√≥jec", "GrudziƒÖdz", "Gryfice", "Hrubiesz√≥w", "I≈Çawa", "Inowroc≈Çaw", "Janki", "Jarocin", "Jaros≈Çaw", "Jas≈Ço", "Jastrzƒôbie Zdr√≥j", "Jaworzno", "Jelenia G√≥rra", "Kalisz", "Katowice", "Kƒôdzierzyn-Ko≈∫le", "Kƒôpno", "Kƒôtrzyn", "Kƒôty", "Kielce", "K≈Çodzko", "Kluczbork", "Knur√≥w", "Kobierzyce", "Ko≈Ço", "Ko≈Çobrzeg", "Konin", "Ko≈Ñskie", "Ko≈õcian", "Ko≈õcierzyna", "Kostrzyn Nad OdrƒÖ", "Koszalin", "Kozienice", "Krak√≥w", "Krasnystaw", "Krosno", "Krotoszyn", "Kutno", "Kwidzyn", "Lƒôbork", "≈Åƒôczna", "Legionowo", "Legnica", "Leszno", "Limanowa", "≈Å√≥d≈∫", "≈Åom≈ºa", "≈Åowicz", "Luba≈Ñ", "Lubart√≥w", "Lubin", "Lublin", "Lubliniec", "≈Åuk√≥w", "Malbork", "Mielec", "Miko≈Ç√≥w", "Mi≈Ñsk Mazowiecki", "M≈Çawa", "MrƒÖgowo", "My≈õlenice", "Mys≈Çowice", "Myszk√≥w", "Namys≈Ç√≥w", "Nowa S√≥l", "Nowy Dw√≥r Mazowiecki", "Nowy SƒÖcz", "Nowy Targ", "Nowy Tomy≈õl", "Nysa", "O≈Çawa", "Olecko", "Ole≈õnica", "Olkusz", "Olsztyn", "Opoczno", "Opole", "Ostr√≥da", "Ostro≈Çƒôka", "Ostr√≥w Mazowiecka", "Ostr√≥w Wielkopolski", "Ostrowiec ≈öwiƒôtokrzyski", "O≈õwiƒôcim", "Otwock", "Pabianice", "Piaseczno", "Piekary ≈ölƒÖskie", "Pi≈Ça", "Piotrk√≥w Trybunalski", "Pisz", "Pleszew", "P≈Çock", "P≈Ço≈Ñsk", "Police", "Polkowice", "Pozna≈Ñ", "Prudnik", "Pruszcz Gda≈Ñski", "Pruszk√≥w", "Przasnysz", "Przemy≈õl", "Pszczyna", "Puck", "Pu≈Çawy", "Pyskowice", "Racib√≥rz", "Radom", "Radomsko", "Rawa Mazowiecka", "Rawicz", "Ruda ≈ölƒÖska", "Rumia", "Rybnik", "Rzesz√≥w", "Sandomierz", "Sanok", "Siedlce", "Siemianowice ≈ölƒÖskie", "Sieradz", "Sierpc", "Skar≈ºysko-Kamienna", "Skierniewice", "Skocz√≥w", "S≈Çupsk", "Sochaczew", "Soko≈Ç√≥w Podlaski", "Solec Kujawski", "Sosnowiec", "≈örem", "≈öroda Wielkopolska", "Stalowa Wola", "Starachowice", "Stargard", "Starogard Gda≈Ñski", "Stojad≈Ça", "Strzegom", "Strzelce Opolskie", "Suwa≈Çki", "Swarzƒôdz", "≈öwidnica", "≈öwidnik", "≈öwidwin", "≈öwiebodzin", "≈öwiecie", "≈öwiƒôtoch≈Çowice", "≈öwinouj≈õcie", "Szamotu≈Çy", "Szczawno Zdr√≥j", "Szczecin", "Szczecinek", "Szczytno", "Tarnobrzeg", "Tarn√≥w", "Tarnowo Podg√≥rne", "Tarnowskie G√≥ry", "Tczew", "Tomasz√≥w Lubelski", "Tomasz√≥w Mazowiecki", "Toru≈Ñ", "Trzcianka", "Turek", "Tychy", "Wadowice", "Warszawa", "Warszawa Bia≈Ço≈Çƒôka", "Warszawa Mokot√≥w", "Warszawa Ochota", "Warszawa Praga", "Warszawa ≈ör√≥dmie≈õcie", "Warszawa Wola/≈ªoliborz", "Wejherowo", "Wielu≈Ñ", "W≈Çoc≈Çawek", "Wodzis≈Çaw ≈ölƒÖski", "Wo≈Çomin", "Wolsztyn", "Wroc≈Çaw", "Wrze≈õnia", "Wyszk√≥w", "Zabrze", "≈ªaga≈Ñ", "Zakopane", "Zambr√≥w", "Zamo≈õƒá", "≈ªary", "Zawiercie", "Zdu≈Ñska Wola", "Zƒôbowice", "Zgierz", "Zgorzelec", "Zielona G√≥ra", "≈ªory", "≈ªyrard√≥w", "≈ªywiec"];
    const positiveStatuses = ["AVAILABLE", "RESERVE_AND_COLLECT", "RESERVATION_FOR_TOMORROW", "AVAILABLE_LOCALLY_IN_SHOP", "RESERVATION_FOR_GIVEN_DATE"];

    const playSuccessSound = () => {
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        [523.25, 659.25, 783.99, 1046.50].forEach((freq, i) => {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.frequency.value = freq;
            gain.gain.setValueAtTime(0, audioCtx.currentTime);
            gain.gain.linearRampToValueAtTime(0.1, audioCtx.currentTime + i * 0.15);
            gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + i * 0.15 + 0.5);
            osc.start(audioCtx.currentTime + i * 0.15); osc.stop(audioCtx.currentTime + i * 0.15 + 0.6);
        });
    };

    console.log("‚è≥ Fetching shop directory...");
    const shopDirResp = await fetch("https://www.euro.com.pl/rest/api/shops");
    const shopData = await shopDirResp.json();
    const shopMap = {};
    shopData.forEach(s => {
        shopMap[s.shopCode] = { name: s.name, address: `${s.city}, ${s.street} ${s.houseNumber}` };
    });

    let totalShopsChecked = 0, foundMatches = [], statusCounts = {};

    console.log(`%cüöÄ SCANNING FOR ID: ${productId}`, "color: white; background: #333; padding: 5px; font-weight: bold;");

    for (const city of cities) {
        try {
            const r = await fetch(`https://www.euro.com.pl/rest/api/products/${productId}/shops?areaName=${encodeURIComponent(city)}`);
            if (r.status === 200) {
                const data = await r.json();
                console.log(`%cüèôÔ∏è City: ${city}`, "font-weight: bold; text-decoration: underline; margin-top: 8px;");
                totalShopsChecked += data.length;
                data.forEach((shop, index) => {
                    const status = shop.productAvailability;
                    statusCounts[status] = (statusCounts[status] || 0) + 1;
                    const isPositive = positiveStatuses.includes(status);
                    const info = shopMap[shop.shopCode] || { name: "Unknown", address: "Unknown" };
                    if (isPositive) foundMatches.push({ City: city, Code: shop.shopCode, Name: info.name, Address: info.address, Status: status });
                    let color = isPositive ? "green" : (status.includes("DISABLED") ? "red" : "#888");
                    console.log(`   ${index + 1}. [${shop.shopCode}] ${info.name}: %c${status}%c`, `color: ${color}; font-weight: bold;`, "");
                });
            }
        } catch (err) { console.error(`üî• ${city}: Fetch Error`); }
        await new Promise(r => setTimeout(r, 400));
    }

    console.log("\n" + "=".repeat(60));
    console.log(`%cüìä FINAL SUMMARY FOR ID: ${productId}`, "color: white; background: blue; padding: 5px; font-weight: bold;");
    console.table(statusCounts);
    if (foundMatches.length > 0) {
        console.log(`\n%c‚úÖ AVAILABLE AT (ID: ${productId}):`, "color: green; font-weight: bold;");
        console.table(foundMatches);
        playSuccessSound();
    } else { console.log(`\n%c‚ùå No actionable stock found for ID ${productId}.`, "color: red; font-weight: bold;"); }
    console.log(`\nFinished checking Product ID: ${productId}`);
    console.log("=".repeat(60));
})();